/*!
 * Audio: Audio driver and sound output.
 * Copyright (c) 2016 Martin Borik <mborik@users.sourceforge.net>
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the "Software"),
 * to deal in the Software without restriction, including without limitation
 * the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom
 * the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS
 * OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF
 * OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
var AudioDriver=function(){function a(){var a=null,b=null,c=getCompatible(window,"AudioContext",!0),d=function(b){var c=b.outputBuffer;a.getAudio(c.getChannelData(0),c.getChannelData(1),c.length)};null!==c.createScriptProcessor?b=c.createScriptProcessor(0,0,2):null!==c.createJavaScriptNode&&(b=c.createJavaScriptNode(0,0,2)),b.onaudioprocess=null,this.sampleRate=c.sampleRate,this.bufferSize=b.bufferSize,this.setAudioSource=function(b){a=b},this.play=function(){a&&a.getAudio&&!b.onaudioprocess&&(b.onaudioprocess=d,b.connect(c.destination))},this.stop=function(){b.onaudioprocess&&b.disconnect(c.destination),b.onaudioprocess=null}}function b(){this.sampleRate=44100,this.bufferSize=4096;var a=new Audio,b=new Float32Array(this.sampleRate>>1),c=b.length,d=null,e=null;a.mozSetup(2,this.sampleRate),this.setAudioSource=function(a){e=a},this.play=function(){if(null==d){var f=(new Date).getTime();d=setInterval(function(){var d=(new Date).getTime();if(250>d-f)for(c<b.length&&(c+=a.mozWriteAudio(b.subarray(c)));c>=b.length;){var g=b.length>>1,h=b.subarray(0,g),i=b.subarray(0,g);e.getAudio(h,i,g);for(var j=0,k=0;g>j;k++)b[j++]=h[k],b[j++]=i[k];c=a.mozWriteAudio(b)}f=d},125)}},this.stop=function(){null!=d&&(clearInterval(d),d=null)}}if(getCompatible(window,"AudioContext",!1,!1))return new a;if("undefined"!=typeof Audio)return new b;throw"Error: No audio driver found (incompatible or obsolete browser)"}();