/*!
 * Audio: Audio driver and sound output.
 * Copyright (c) 2015 Martin Borik <mborik@users.sourceforge.net>
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the "Software"),
 * to deal in the Software without restriction, including without limitation
 * the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom
 * the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS
 * OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF
 * OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
var AudioDriver=function(){function a(a){var b,c;return a=a||d,b=e/1e3*a,c=Math.ceil(Math.log(b)*Math.LOG2E),c=8>c?8:c>14?14:c,1<<c}function b(){var b=null,c=null,d=getCompatible(window,"AudioContext",!0),e=function(a){var c=a.outputBuffer;b.getAudio(c.getChannelData(0),c.getChannelData(1),c.length)};this.sampleRate=d.sampleRate,this.bufferSize=a(d.sampleRate),null!==d.createScriptProcessor?c=d.createScriptProcessor(this.bufferSize,0,2):null!==d.createJavaScriptNode&&(c=d.createJavaScriptNode(this.bufferSize,0,2)),c.onaudioprocess=null,this.bufferSize=c.bufferSize,this.setAudioSource=function(a){b=a},this.play=function(){b&&b.getAudio&&!c.onaudioprocess&&(c.onaudioprocess=e,c.connect(d.destination))},this.stop=function(){c.onaudioprocess&&c.disconnect(d.destination),c.onaudioprocess=null}}function c(){this.sampleRate=d,this.bufferSize=a(b.sampleRate);var b=new Audio,c=new Float32Array(this.sampleRate>>1),e=c.length,f=null,g=null;b.mozSetup(2,this.sampleRate),this.setAudioSource=function(a){g=a},this.play=function(){if(null==f){var a=(new Date).getTime();f=setInterval(function(){var d=(new Date).getTime();if(250>d-a)for(e<c.length&&(e+=b.mozWriteAudio(c.subarray(e)));e>=c.length;){var f=c.length>>1,h=c.subarray(0,f),i=c.subarray(0,f);g.getAudio(h,i,f);for(var j=0,k=0;f>j;k++)c[j++]=h[k],c[j++]=i[k];e=b.mozWriteAudio(c)}a=d},125)}},this.stop=function(){null!=f&&(clearInterval(f),f=null)}}var d=44100,e=80;if(getCompatible(window,"AudioContext",!1,!1))return new b;if("undefined"!=typeof Audio)return new c;throw"Error: No audio driver found (incompatible or obsolete browser)"}();